<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My YouTube - Local MP4 Player</title>
  <style>
    :root { color-scheme: light dark; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { display: grid; grid-template-rows: auto 1fr; background: var(--bg, #0f0f0f); color: var(--fg, #e6e6e6); }

    header { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-bottom: 1px solid #333; }
    header h1 { font-size: 18px; margin: 0; font-weight: 600; }
    .spacer { flex: 1; }

    .controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .btn { appearance: none; border: 1px solid #444; background: #1f1f1f; color: inherit; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
    .btn:hover { background: #2a2a2a; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    input[type="file"] { display: none; }
    label[for="file-input"] { border: 1px dashed #555; padding: 8px 12px; border-radius: 8px; cursor: pointer; }

    main { display: grid; grid-template-columns: 2fr 1fr; height: 100%; min-height: 0; }
    @media (max-width: 960px) { main { grid-template-columns: 1fr; grid-auto-rows: auto auto; } }

    .player { display: grid; grid-template-rows: 1fr auto; min-height: 0; }
    video { width: 100%; height: 100%; background: black; }

    .player-controls { display: flex; gap: 8px; align-items: center; padding: 10px 12px; border-top: 1px solid #333; }
    .player-controls .grow { flex: 1; }
    .slider { width: 180px; }

    .sidebar { border-left: 1px solid #333; min-height: 0; display: grid; grid-template-rows: auto 1fr; }
    .dropzone { margin: 12px; padding: 12px; border: 2px dashed #555; border-radius: 10px; text-align: center; }
    .dropzone.dragover { background: rgba(255,255,255,0.05); border-color: #888; }

    .list { overflow: auto; padding: 8px; }
    .item { display: grid; grid-template-columns: auto 1fr auto; gap: 8px; align-items: center; padding: 8px; border-radius: 8px; cursor: pointer; }
    .item:hover { background: rgba(255,255,255,0.05); }
    .item.active { background: rgba(29,155,240,0.15); }
    .item .index { width: 28px; text-align: right; color: #aaa; }
    .item .title { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .item .duration { color: #aaa; font-variant-numeric: tabular-nums; }

    .muted { color: #aaa; }
    small.kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #222; border: 1px solid #444; padding: 1px 6px; border-radius: 6px; }
  </style>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect rx='12' width='64' height='64' fill='%23ff0033'/%3E%3Cpolygon points='26,20 26,44 46,32' fill='white'/%3E%3C/svg%3E">
  <meta name="description" content="Upload MP4 files and watch them in a simple YouTube-like player, locally in your browser.">
</head>
<body>
  <header>
    <h1>My YouTube</h1>
    <div class="spacer"></div>
    <div class="controls">
      <label for="file-input" class="muted">Add videos</label>
      <input id="file-input" type="file" accept="video/mp4,video/webm,video/ogg" multiple>
      <button id="btn-prev" class="btn" title="Previous (Shift+P)">Prev</button>
      <button id="btn-next" class="btn" title="Next (Shift+N)">Next</button>
      <button id="btn-clear" class="btn" title="Clear playlist">Clear</button>
    </div>
  </header>

  <main>
    <section class="player">
      <video id="video" controls preload="metadata"></video>
      <div class="player-controls">
        <button id="btn-play" class="btn">Play/Pause (Space)</button>
        <button id="btn-rewind" class="btn" title="-10s">-10s</button>
        <button id="btn-forward" class="btn" title="+10s">+10s</button>
        <div class="grow"></div>
        <label>Speed <input id="rate" class="slider" type="range" min="0.25" max="2" step="0.05"></label>
        <label>Volume <input id="volume" class="slider" type="range" min="0" max="1" step="0.01"></label>
      </div>
    </section>

    <aside class="sidebar">
      <div id="dropzone" class="dropzone">
        <div><strong>Drop videos here</strong> or use "Add videos"</div>
        <div class="muted" style="margin-top:6px;">
          Tips: <small class="kbd">Space</small> play/pause, <small class="kbd">←/→</small> seek, <small class="kbd">Shift+N</small>/<small class="kbd">Shift+P</small> next/prev
        </div>
      </div>
      <div id="list" class="list" aria-label="Playlist"></div>
    </aside>
  </main>

  <script>
    (function() {
      /** State **/
      /** @type {{ id: string; name: string; url: string; type: string; duration?: number }[]} */
      let playlist = [];
      let currentIndex = -1;

      /** Elements **/
      const fileInput = document.getElementById('file-input');
      const dropzone = document.getElementById('dropzone');
      const listEl = document.getElementById('list');
      const video = document.getElementById('video');

      const btnPrev = document.getElementById('btn-prev');
      const btnNext = document.getElementById('btn-next');
      const btnClear = document.getElementById('btn-clear');
      const btnPlay = document.getElementById('btn-play');
      const btnRewind = document.getElementById('btn-rewind');
      const btnForward = document.getElementById('btn-forward');
      const volumeSlider = document.getElementById('volume');
      const rateSlider = document.getElementById('rate');

      /** Utilities **/
      function generateId() {
        return 'vid_' + Math.random().toString(36).slice(2) + Date.now().toString(36);
      }

      function secondsToHms(totalSeconds) {
        if (!Number.isFinite(totalSeconds)) return '';
        const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
        const m = Math.floor((totalSeconds / 60) % 60).toString().padStart(2, '0');
        const h = Math.floor(totalSeconds / 3600);
        return (h > 0 ? h + ':' : '') + m + ':' + s;
      }

      function saveSettings() {
        const data = {
          volume: video.volume,
          rate: video.playbackRate,
        };
        localStorage.setItem('myyt_settings', JSON.stringify(data));
      }

      function restoreSettings() {
        try {
          const raw = localStorage.getItem('myyt_settings');
          if (!raw) return;
          const data = JSON.parse(raw);
          if (typeof data.volume === 'number') video.volume = data.volume;
          if (typeof data.rate === 'number') video.playbackRate = data.rate;
        } catch {}
      }

      /** Playlist rendering **/
      function renderList() {
        listEl.innerHTML = '';
        playlist.forEach((item, index) => {
          const row = document.createElement('div');
          row.className = 'item' + (index === currentIndex ? ' active' : '');
          row.dataset.id = item.id;

          const idx = document.createElement('div');
          idx.className = 'index';
          idx.textContent = String(index + 1);

          const title = document.createElement('div');
          title.className = 'title';
          title.textContent = item.name;

          const dur = document.createElement('div');
          dur.className = 'duration';
          dur.textContent = item.duration ? secondsToHms(item.duration) : '';

          row.appendChild(idx);
          row.appendChild(title);
          row.appendChild(dur);
          row.addEventListener('click', () => playIndex(index));
          listEl.appendChild(row);
        });
      }

      function updateActiveRow() {
        const rows = listEl.querySelectorAll('.item');
        rows.forEach((r, i) => {
          if (i === currentIndex) r.classList.add('active');
          else r.classList.remove('active');
        });
      }

      /** Playlist actions **/
      function addFiles(fileList) {
        const files = Array.from(fileList).filter(f => f.type.startsWith('video/'));
        if (files.length === 0) return;
        const newItems = files.map(f => ({ id: generateId(), name: f.name, type: f.type, url: URL.createObjectURL(f) }));
        playlist = playlist.concat(newItems);
        renderList();
        // Probe durations in background
        newItems.forEach((item, indexOffset) => probeDuration(item, playlist.length - newItems.length + indexOffset));
        if (currentIndex === -1) { playIndex(0); }
      }

      function clearPlaylist() {
        playlist.forEach(p => { try { URL.revokeObjectURL(p.url); } catch {} });
        playlist = [];
        currentIndex = -1;
        renderList();
        video.removeAttribute('src');
        video.load();
      }

      function probeDuration(item, index) {
        const temp = document.createElement('video');
        temp.preload = 'metadata';
        temp.src = item.url;
        const onLoaded = () => {
          item.duration = temp.duration;
          if (Number.isFinite(item.duration)) {
            const row = listEl.children[index];
            if (row) {
              const durEl = row.querySelector('.duration');
              if (durEl) durEl.textContent = secondsToHms(item.duration);
            }
          }
          cleanup();
        };
        const onError = () => cleanup();
        const cleanup = () => {
          temp.removeEventListener('loadedmetadata', onLoaded);
          temp.removeEventListener('error', onError);
          temp.src = '';
        };
        temp.addEventListener('loadedmetadata', onLoaded);
        temp.addEventListener('error', onError);
      }

      function playIndex(index) {
        if (index < 0 || index >= playlist.length) return;
        currentIndex = index;
        const item = playlist[index];
        video.src = item.url;
        video.play().catch(() => {});
        updateActiveRow();
      }

      function playNext() { if (currentIndex + 1 < playlist.length) playIndex(currentIndex + 1); }
      function playPrev() { if (currentIndex - 1 >= 0) playIndex(currentIndex - 1); }

      /** Wire UI **/
      fileInput.addEventListener('change', (e) => { addFiles(e.target.files || []); fileInput.value = ''; });
      btnNext.addEventListener('click', playNext);
      btnPrev.addEventListener('click', playPrev);
      btnClear.addEventListener('click', clearPlaylist);

      btnPlay.addEventListener('click', () => { if (video.paused) video.play(); else video.pause(); });
      btnRewind.addEventListener('click', () => { video.currentTime = Math.max(0, video.currentTime - 10); });
      btnForward.addEventListener('click', () => { video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 10); });

      volumeSlider.addEventListener('input', () => { video.volume = Number(volumeSlider.value); saveSettings(); });
      rateSlider.addEventListener('input', () => { video.playbackRate = Number(rateSlider.value); saveSettings(); });

      video.addEventListener('ended', playNext);
      video.addEventListener('volumechange', saveSettings);
      video.addEventListener('ratechange', saveSettings);

      // Drag & Drop
      ;['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); }));
      ;['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); }));
      dropzone.addEventListener('drop', (e) => { if (e.dataTransfer) addFiles(e.dataTransfer.files); });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.target && (/** @type {HTMLElement} */(e.target)).tagName === 'INPUT') return;
        if (e.code === 'Space') { e.preventDefault(); if (video.paused) video.play(); else video.pause(); }
        if (e.key === 'ArrowRight') { video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 5); }
        if (e.key === 'ArrowLeft') { video.currentTime = Math.max(0, video.currentTime - 5); }
        if (e.shiftKey && (e.key === 'N' || e.key === 'n')) { playNext(); }
        if (e.shiftKey && (e.key === 'P' || e.key === 'p')) { playPrev(); }
      });

      // Init settings UI
      restoreSettings();
      volumeSlider.value = String(video.volume);
      rateSlider.value = String(video.playbackRate);
    })();
  </script>
</body>
</html>


